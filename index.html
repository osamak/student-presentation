<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>عرض الافتتاح</title>
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <link type="text/css" rel="stylesheet" href="sh/styles/shCoreDefault.css"/>
    <link href="css/animate.min.css" rel="stylesheet" type="text/css">
    <style>
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
cmargin: 0;
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
}


.step {
    position: relative;
    width: 900px;
    padding: 40px;
    margin: 20px auto;

    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    -o-box-sizing: border-box;
    box-sizing: border-box;
    font-family: 'GE Dinar One', 'Myriad Pro', Arial;
    font-size: 48px;
    line-height: 1.5;
}

.impress-enabled .step {
    margin: 0;
    opacity: 0.3;

    -webkit-transition: opacity 1s;
    -moz-transition: opacity 1s;
    -ms-transition: opacity 1s;
    -o-transition: opacity 1s;
    transition: opacity 1s;
}

.impress-enabled .step.active { opacity: 1 }

/* What's above is copied from impress.js demo. */

@font-face {
    font-family: 'GE Dinar One';
    font-weight: lighter;
    font-size: xx-large;
    src: url("fonts/ge-dinar-one-light.woff");
}
		
@font-face {
    font-family: 'GE Dinar One';
    font-weight: normal;
    src: url("fonts/ge-dinar-one-med.woff");
}

@font-face {
  font-family: 'Love Ya Like A Sister';
  font-style: normal;
  font-weight: 400;
  src: local('Love Ya Like A Sister Regular'), local('LoveYaLikeASister-Regular'), url(fonts/LoveYaLikeASister.woff) format('woff');
}

@font-face {
    font-family: 'Myriad Pro';
    font-weight: lighter;
    src: url("fonts/MyriadPro-Light.otf");
}

body {
    background-color: #00A651; /* rgb(233, 225, 71);*/
    color: white;
    min-height: 740px;
}
p {
    font-size:60px;
    text-align:center;
}

.center {
    text-align:center;
}
.counter {
    display: none;
    margin: 0;
    padding-bottom: 70px;
    font-size: 150px;
    font-family: 'Love Ya Like A Sister', cursive;
}
.counter-text {
   display: none;
   padding: 0;
   margin: 0;
}

#progress {
    background-image: url(img/progress.png);
    background-position: bottom right;
    background-repeat: no-repeat;
}

#progress p{
    width: 55%;
    font-size: 80px;
    float: left;
}

#time {
    visibility: hidden;
    background-image: url(img/appointment-new.svg);
    background-position: bottom left;
    background-repeat: no-repeat;
    min-height: 500px;
}

#time p {
    text-align: right;
}

#sample-code {
    direction: ltr;
    text-align: left;
    overflow: scroll;
    height: 450px;
    font-family: monospace;
    font-size: 15px !important;
}


#niqati1 {
    min-height: 450px;
}
    </style>
    <script type="text/javascript">
$(function() {
    var duration = 1000;
    $(window).bind( 'hashchange', function(e) { 
    var anchor = document.location.hash;
            // In the fourth slide, we have the activity counter.
            if( anchor === '#/activities' ) {
               $("#activity-counter").show(); // It's hidden by default.
               var amount=400; // The number of activities
               $({c:0}).animate({c:amount}, { 
                    step: function(now) {
                        $("#activity-counter").text(Math.round(now))
                    },
                    duration: duration, // The counter should finish in seconds.
                    easing: "linear",
                    complete: function() {$("#activity-counter").css('padding-bottom','0');$("#activity-text").show();$('#activity-text').addClass('animated bounceInRight');} // Run this when the animation is finished.
                });
            }
            else if( anchor === '#/emails' ) {
               $("#email-counter").show(); // It's hidden by default.
               var amount=9000; // The number of activities
               $({c:0}).animate({c:amount}, { 
                    step: function(now) {
                        $("#email-counter").text(Math.round(now))
                    },
                    duration: duration, // The counter should finish in seconds.
                    easing: "linear",
                    complete: function() {$("#email-counter").css('padding-bottom','0');$("#email-text").show();$('#email-text').addClass('animated bounceInRight');} // Run this when the animation is finished.
                });
            }
            else if( anchor === '#/time' ) {
               $("#time").css("visibility", "visible")
               $("#time-counter").show(); // It's hidden by default.
               var amount=175; // The number of activities
               $({c:0}).animate({c:amount}, { 
                    step: function(now) {
                        $("#time-counter").text(Math.round(now))
                    },
                    duration: duration, // The counter should finish in seconds.
                    easing: "linear",
                    complete: function() {$("#time-counter").css('padding','0');$("#time-text").show();$('#time-text').addClass('animated bounceInRight');} // Run this when the animation is finished.
                });
            }
            else if( anchor === '#/source' ) {
                var pre = $('#sample-code');
                var scroller = setInterval(function(){
                    var pos = pre.scrollTop();
                    pre.scrollTop(pos+15);
                    if(pre.scrollTop() + pre.innerHeight() >= $("#sample-code")[0].scrollHeight){
                        clearInterval(scroller);
                    }
                }, 20);
            }
            else if( anchor === '#/final' ) {
//                var win = window.open('http://localhost:8000/?launch', '_blank');
//                if(win){
//                    //Browser has allowed it to be opened
//                    win.focus();
//                }else{
//                    //Broswer has blocked it
//                    alert('Please allow popups for this site');
//                }
                window.location.href = 'http://localhost:8000/?launch';
            }
    });
});

    </script>
    </head>
  <body>
    <div id="impress">
      <div id="start" class="step" data-rotate-x="-45" data-y="-350" data-z="-350" data-scale=".5"><bdi>
         <br>
      </bdi></div>
      <div id="progress" class="step"><bdi>
        <p>نادي الطلاب في نمو!</p>
      </bdi></div>
      <div id='activities' class="step" data-x="350" data-y="-50" data-z="50" data-rotate="00" data-rotate-y="-20" data-scale="0.3"><bdi>
        <p id="activity-counter" class="counter"></p>
         <p id="activity-text" class="counter-text">نشاط</p>
      </bdi></div>
      <div id='emails' class="step" data-x="350" data-y="-50" data-z="-50" data-rotate-y="110" data-scale="0.3"><bdi>
        <p id="email-counter" class="counter"></p>
         <p  id="email-text" class="counter-text">بريد</p>
      </bdi></div>
      <div id='time' class="step" data-x="230" data-y="-50" data-rotate-y="230" data-scale="0.3"><bdi>
        <p id="time-counter" class="counter"></p>
         <p id="time-text" class="counter-text">ساعة</p>
      </bdi></div>
      <div id='niqati1' class="step" data-x="-3000" data-y="-1200" data-scale="0.4"><bdi>
        <p>برنامج نقاطي الإلكتروني</p>
        <center><img src="img/niqati.png"></center>
      </bdi></div>
        <div id='niqati2' class="step" data-x="-3000" data-y="-2200" data-scale="0.4"><bdi>
        <img src="img/coupon.png" width="100%"/>
      </bdi></div>
        
        <div id='niqati3' class="step" data-x="-2900" data-y="-2200" data-z="-100" data-rotate-y="120" data-scale="0.4"><bdi>
        <center><img src="img/niqati_interface.png" height="600px"></center>
      </bdi></div>
        
        <div id='niqati4' class="step" data-x="-3100" data-y="-2200" data-z="-100" data-rotate-y="240" data-scale="0.4"><bdi>
        <center><img src="img/niqati_report.png" height="650px"/></center>
      </bdi></div>
    
      <div id='source' class="step" data-x="-6000" data-y="-1200"
      data-scale="1"><bdi>
<p id="sample-code" class="syntaxhighlighter">
<code class="python comments"># -*- coding: utf-8&nbsp; -*-</code><br/>
<code class="python keyword">import</code> <code class="python plain">unicodecsv</code><br/>
&nbsp;<br/>
<code class="python keyword">from</code> <code class="python plain">django.contrib.auth.decorators </code><code class="python keyword">import</code> <code class="python plain">permission_required, login_required</code><br/>
<code class="python keyword">from</code> <code class="python plain">django.shortcuts </code><code class="python keyword">import</code> <code class="python plain">render, get_object_or_404</code><br/>
<code class="python keyword">from</code> <code class="python plain">django.http </code><code class="python keyword">import</code> <code class="python plain">HttpResponse, HttpResponseRedirect</code><br/>
<code class="python keyword">from</code> <code class="python plain">django.forms </code><code class="python keyword">import</code> <code class="python plain">ModelForm, ModelChoiceField, ModelMultipleChoiceField</code><br/>
<code class="python keyword">from</code> <code class="python plain">django.core.paginator </code><code class="python keyword">import</code> <code class="python plain">Paginator, EmptyPage, PageNotAnInteger</code><br/>
<code class="python keyword">from</code> <code class="python plain">django.core.urlresolvers </code><code class="python keyword">import</code> <code class="python plain">reverse</code><br/>
<code class="python keyword">from</code> <code class="python plain">django.core.exceptions </code><code class="python keyword">import</code> <code class="python plain">PermissionDenied, ObjectDoesNotExist</code><br/>
&nbsp;<br/>
<code class="python keyword">from</code> <code class="python plain">activities.models </code><code class="python keyword">import</code> <code class="python plain">Activity, Review, Participation</code><br/>
<code class="python keyword">from</code> <code class="python plain">clubs.models </code><code class="python keyword">import</code> <code class="python plain">Club</code><br/>
&nbsp;<br/>
<code class="python keyword">class</code> <code class="python plain">ActivityForm(ModelForm):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">"""A general form, which doesn't include 'Presidency'."""</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">queryset </code><code class="python keyword">=</code> <code class="python plain">Club.objects.exclude(english_name</code><code class="python keyword">=</code><code class="python string">"Presidency"</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">primary_club </code><code class="python keyword">=</code> <code class="python plain">ModelChoiceField(queryset</code><code class="python keyword">=</code><code class="python plain">queryset,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">label</code><code class="python keyword">=</code><code class="python plain">Activity.primary_club.field.verbose_name,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">help_text</code><code class="python keyword">=</code><code class="python plain">Activity.primary_club.field.help_text)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">secondary_clubs </code><code class="python keyword">=</code> <code class="python plain">ModelMultipleChoiceField(queryset</code><code class="python keyword">=</code><code class="python plain">queryset,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">label</code><code class="python keyword">=</code><code class="python plain">Activity.secondary_clubs.field.verbose_name,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">help_text</code><code class="python keyword">=</code><code class="python plain">Activity.secondary_clubs.field.help_text,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">required</code><code class="python keyword">=</code><code class="python color1">False</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">class</code> <code class="python plain">Meta:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">model </code><code class="python keyword">=</code> <code class="python plain">Activity</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">fields </code><code class="python keyword">=</code> <code class="python plain">[</code><code class="python string">'primary_club'</code><code class="python plain">, </code><code class="python comments"># TODO: primary club is already known (signed in):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># no need to include as field</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'name'</code><code class="python plain">,</code><code class="python string">'description'</code><code class="python plain">, </code><code class="python string">'date'</code><code class="python plain">, </code><code class="python string">'time'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'custom_datetime'</code><code class="python plain">, </code><code class="python string">'organizers'</code><code class="python plain">, </code><code class="python string">'participants'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'secondary_clubs'</code><code class="python plain">, </code><code class="python string">'inside_collaborators'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'outside_collaborators'</code><code class="python plain">, </code><code class="python string">'requirements'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'collect_participants'</code><code class="python plain">, </code><code class="python string">'participant_colleges'</code><code class="python plain">]</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">clean(</code><code class="python color1">self</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># Remove spaces at the start and end of all text fields.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">cleaned_data </code><code class="python keyword">=</code> <code class="python functions">super</code><code class="python plain">(ActivityForm, </code><code class="python color1">self</code><code class="python plain">).clean()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">for</code> <code class="python plain">field </code><code class="python keyword">in</code> <code class="python plain">cleaned_data:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python functions">isinstance</code><code class="python plain">(cleaned_data[field], </code><code class="python functions">unicode</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">cleaned_data[field] </code><code class="python keyword">=</code> <code class="python plain">cleaned_data[field].strip()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">cleaned_data</code><br/>
&nbsp;<br/>
<code class="python keyword">class</code> <code class="python plain">DirectActivityForm(ActivityForm):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">"""A form which has 'Presidency' as an option."""</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">queryset </code><code class="python keyword">=</code> <code class="python plain">Club.objects.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">primary_club </code><code class="python keyword">=</code> <code class="python plain">ModelChoiceField(queryset</code><code class="python keyword">=</code><code class="python plain">queryset,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">label</code><code class="python keyword">=</code><code class="python plain">Activity.primary_club.field.verbose_name,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">help_text</code><code class="python keyword">=</code><code class="python plain">Activity.primary_club.field.help_text)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">secondary_clubs </code><code class="python keyword">=</code> <code class="python plain">ModelMultipleChoiceField(queryset</code><code class="python keyword">=</code><code class="python plain">queryset,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">label</code><code class="python keyword">=</code><code class="python plain">Activity.secondary_clubs.field.verbose_name,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">help_text</code><code class="python keyword">=</code><code class="python plain">Activity.secondary_clubs.field.help_text,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">required</code><code class="python keyword">=</code><code class="python color1">False</code><code class="python plain">)</code><br/>
<code class="python keyword">class</code> <code class="python plain">ReviewForm(ModelForm):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">class</code> <code class="python plain">Meta:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">model </code><code class="python keyword">=</code> <code class="python plain">Review</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">fields </code><code class="python keyword">=</code> <code class="python plain">[</code><code class="python string">'clubs_notes'</code><code class="python plain">, </code><code class="python string">'name_notes'</code><code class="python plain">, </code><code class="python string">'description_notes'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'datetime_notes'</code><code class="python plain">, </code><code class="python string">'requirement_notes'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'inside_notes'</code><code class="python plain">, </code><code class="python string">'outside_notes'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'organizers_notes'</code><code class="python plain">, </code><code class="python string">'participants_notes'</code><code class="python plain">, </code><code class="python string">'is_approved'</code><code class="python plain">]</code><br/>
&nbsp;<br/>
<code class="python keyword">def</code> <code class="python plain">portal_home(request):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If the user is logged in, return the admin dashboard;</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If not, return the front-end homepage</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.is_authenticated():</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'home.html'</code><code class="python plain">) </code><code class="python comments"># the dashboard</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'front/home_front.html'</code><code class="python plain">)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python functions">list</code><code class="python plain">(request):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If the user is part of the head of the Student Club, or part of</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># the Media Team, they should be able to view all activities</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># (i.e. approved, rejected and pending).&nbsp; Otherwise, a user should</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># only see approved activities and the activities of the clubs</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># they have memberships in (regardless of their status).</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.view_activity'</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.GET.get(</code><code class="python string">'pending'</code><code class="python plain">) </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">"1"</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.</code><code class="python functions">filter</code><code class="python plain">(review__is_approved</code><code class="python keyword">=</code><code class="python color1">None</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">approved_activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.</code><code class="python functions">filter</code><code class="python plain">(review__is_approved</code><code class="python keyword">=</code><code class="python color1">True</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.is_authenticated():</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_activities </code><code class="python keyword">=</code> <code class="python plain">request.user.activity_set.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_clubs </code><code class="python keyword">=</code> <code class="python plain">request.user.memberships.</code><code class="python functions">all</code><code class="python plain">() | request.user.coordination.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">primary_activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.</code><code class="python functions">filter</code><code class="python plain">(</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">primary_club__in</code><code class="python keyword">=</code><code class="python plain">user_clubs)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">secondary_activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.</code><code class="python functions">filter</code><code class="python plain">(</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">secondary_clubs__in</code><code class="python keyword">=</code><code class="python plain">user_clubs)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.none()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">primary_activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.none()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">secondary_activities </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.none()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activities </code><code class="python keyword">=</code> <code class="python plain">approved_activities | user_activities | \</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">primary_activities | secondary_activities</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">order </code><code class="python keyword">=</code> <code class="python plain">request.GET.get(</code><code class="python string">'order'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">order </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'date'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sorted_activities </code><code class="python keyword">=</code> <code class="python plain">activities.order_by(</code><code class="python string">'-date'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">elif</code> <code class="python plain">order </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'club'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sorted_activities </code><code class="python keyword">=</code> <code class="python plain">activities.order_by(</code><code class="python string">'-primary_club'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sorted_activities </code><code class="python keyword">=</code> <code class="python plain">activities.order_by(</code><code class="python string">'-submission_date'</code><code class="python plain">)</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">#Each page of results should have a maximum of 25 activities.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">paginator </code><code class="python keyword">=</code> <code class="python plain">Paginator(sorted_activities, </code><code class="python value">25</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">page </code><code class="python keyword">=</code> <code class="python plain">request.GET.get(</code><code class="python string">'page'</code><code class="python plain">)</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">page_activities </code><code class="python keyword">=</code> <code class="python plain">paginator.page(page)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">PageNotAnInteger:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If page is not an integer, deliver first page.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">page_activities </code><code class="python keyword">=</code> <code class="python plain">paginator.page(</code><code class="python value">1</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">EmptyPage:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If page is out of range (e.g. 9999), deliver last page of results.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">page_activities </code><code class="python keyword">=</code> <code class="python plain">paginator.page(paginator.num_pages)</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'page_activities'</code><code class="python plain">: page_activities}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># if request.user.is_authenticated():</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/list.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python plain">show(request, activity_id):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If the activity is approved, everyone can see it.&nbsp; If it is not,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># only the head of the Student Club, the Media Team, the members</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># of the related clubs and the person who submitted it can see it.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">get_object_or_404(Activity, pk</code><code class="python keyword">=</code><code class="python plain">activity_id)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'activity'</code><code class="python plain">: activity}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.is_authenticated():</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_clubs </code><code class="python keyword">=</code> <code class="python plain">request.user.memberships.</code><code class="python functions">all</code><code class="python plain">() | request.user.coordination.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">is_coordinator </code><code class="python keyword">=</code> <code class="python plain">activity.primary_club </code><code class="python keyword">in</code> <code class="python plain">request.user.coordination.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.change_activity'</code><code class="python plain">) </code><code class="python keyword">or</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">is_coordinator:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'can_edit'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python color1">True</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.view_participation'</code><code class="python plain">) </code><code class="python keyword">or</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">is_coordinator:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'can_view_participation'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python color1">True</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.can_view_deanship_review'</code><code class="python plain">) </code><code class="python keyword">or</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">is_coordinator:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'can_view_deanship_review'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python color1">True</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.can_view_presidency_review'</code><code class="python plain">) </code><code class="python keyword">or</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">is_coordinator:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'can_view_presidency_review'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python color1">True</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_p </code><code class="python keyword">=</code> <code class="python plain">Review.objects.get(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type</code><code class="python keyword">=</code><code class="python string">'P'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'review_p'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python plain">review_p</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">ObjectDoesNotExist:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">pass</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_clubs </code><code class="python keyword">=</code> <code class="python plain">Activity.objects.none()</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_primary_club </code><code class="python keyword">=</code> <code class="python plain">activity.primary_club</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_secondary_clubs </code><code class="python keyword">=</code> <code class="python plain">activity.secondary_clubs.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_clubs </code><code class="python keyword">=</code> <code class="python plain">[activity_primary_club] </code><code class="python keyword">+</code> <code class="python plain">[club </code><code class="python keyword">for</code> <code class="python plain">club </code><code class="python keyword">in</code> <code class="python plain">activity_secondary_clubs]</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># We obtain the deanship review specifically because, really,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># that's what matters in determining whether a user can see the</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># activity.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_d </code><code class="python keyword">=</code> <code class="python plain">Review.objects.get(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type</code><code class="python keyword">=</code><code class="python string">'D'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'review_d'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python plain">review_d</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">ObjectDoesNotExist:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_d </code><code class="python keyword">=</code> <code class="python color1">False</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># The important review here is the deanship's, beacuse that</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># what would determine whether the activity is accessible.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_status </code><code class="python keyword">=</code> <code class="python plain">review_d</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">ObjectDoesNotExist:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_status </code><code class="python keyword">=</code> <code class="python color1">False</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># The third test condition, that is:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">#&nbsp;&nbsp; any([club in activity_clubs for club in user_clubs])</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">#&nbsp; checks if any of the clubs the user is a member of is also</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">#&nbsp; orginizing the activity that the user is trying to see.&nbsp; If</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">#&nbsp; will be True if any club is one of the organizers and it will</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">#&nbsp; be False if none is.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python keyword">not</code> <code class="python plain">activity_status </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.view_activity'</code><code class="python plain">) </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python functions">any</code><code class="python plain">([club </code><code class="python keyword">in</code> <code class="python plain">activity_clubs </code><code class="python keyword">for</code> <code class="python plain">club </code><code class="python keyword">in</code> <code class="python plain">user_clubs]) </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python plain">request.user </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python plain">activity.submitter:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">raise</code> <code class="python plain">PermissionDenied</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/show.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python decorator">@permission_required</code><code class="python plain">(</code><code class="python string">'activities.add_activity'</code><code class="python plain">, raise_exception</code><code class="python keyword">=</code><code class="python color1">True</code><code class="python plain">)</code><br/>
<code class="python keyword">def</code> <code class="python plain">create(request):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">presidency </code><code class="python keyword">=</code> <code class="python plain">Club.objects.get(english_name</code><code class="python keyword">=</code><code class="python string">"Presidency"</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.method </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'POST'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">Activity(submitter</code><code class="python keyword">=</code><code class="python plain">request.user)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.directly_add_activity'</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">form </code><code class="python keyword">=</code> <code class="python plain">DirectActivityForm(request.POST, instance</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">form </code><code class="python keyword">=</code> <code class="python plain">ActivityForm(request.POST, instance</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">form.is_valid():</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">form_object </code><code class="python keyword">=</code> <code class="python plain">form.save()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If the chosen primary_club is the Presidency, make it</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># automatically approved by the deanship.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">form_object.primary_club </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python plain">presidency:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_object </code><code class="python keyword">=</code> <code class="python plain">Review.objects.create(</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity</code><code class="python keyword">=</code><code class="python plain">form_object, reviewer</code><code class="python keyword">=</code><code class="python plain">request.user,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">is_approved</code><code class="python keyword">=</code><code class="python color1">True</code><code class="python plain">, review_type</code><code class="python keyword">=</code><code class="python string">'D'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">HttpResponseRedirect(reverse(</code><code class="python string">'activities:list'</code><code class="python plain">))</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'form'</code><code class="python plain">: form}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/new.html'</code><code class="python plain">, context)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">can_directly_add </code><code class="python keyword">=</code> <code class="python plain">request.user.has_perm(</code><code class="python string">"activities.directly_add_activity"</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># It is theoretically true that the user can be a</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># coordinator of more than one single club, but we are not</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># taking that into consideration because it is just not</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># common enough.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_club </code><code class="python keyword">=</code> <code class="python plain">request.user.coordination.</code><code class="python functions">all</code><code class="python plain">()[</code><code class="python value">0</code><code class="python plain">]</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">IndexError:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># Make it more user-friendly: if the user is an admin,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># automatically choose presidency as the default</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># primary_club.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">can_directly_add:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_club </code><code class="python keyword">=</code> <code class="python plain">presidency</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_club </code><code class="python keyword">=</code> <code class="python color1">None</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">Activity(primary_club</code><code class="python keyword">=</code><code class="python plain">user_club)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">"activities.directly_add_activity"</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">form </code><code class="python keyword">=</code> <code class="python plain">DirectActivityForm(instance</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">form </code><code class="python keyword">=</code> <code class="python plain">ActivityForm(instance</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'form'</code><code class="python plain">: form}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/new.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python plain">edit(request, activity_id):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">get_object_or_404(Activity, pk</code><code class="python keyword">=</code><code class="python plain">activity_id)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user_coordination </code><code class="python keyword">=</code> <code class="python plain">request.user.coordination.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># We need a QuerySet to combine it with secondary clubs.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_primary_club </code><code class="python keyword">=</code> <code class="python plain">Club.objects.</code><code class="python functions">filter</code><code class="python plain">(</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">id</code><code class="python keyword">=</code><code class="python plain">activity.primary_club.</code><code class="python functions">id</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_secondary_clubs </code><code class="python keyword">=</code> <code class="python plain">activity.secondary_clubs.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity_clubs </code><code class="python keyword">=</code> <code class="python plain">activity_primary_club | activity_secondary_clubs</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># If the user is neither the submitter, nor has the permission to</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># change activities (i.e. not part of the head of the Student</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># Club, or the Media Team), not a coordinator of any of the</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># organizing clubs, raise a PermissionDenied error.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python keyword">not</code> <code class="python plain">request.user </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python plain">activity.submitter </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.change_activity'</code><code class="python plain">) </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python functions">any</code><code class="python plain">([club </code><code class="python keyword">in</code> <code class="python plain">activity_clubs </code><code class="python keyword">for</code> <code class="python plain">club </code><code class="python keyword">in</code> <code class="python plain">user_coordination]):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">raise</code> <code class="python plain">PermissionDenied</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.method </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'POST'</code><code class="python plain">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">modified_activity </code><code class="python keyword">=</code> <code class="python plain">ActivityForm(request.POST, instance</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">modified_activity.save()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">HttpResponseRedirect(reverse(</code><code class="python string">'activities:list'</code><code class="python plain">))</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">form </code><code class="python keyword">=</code> <code class="python plain">ActivityForm(instance</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'form'</code><code class="python plain">: form, </code><code class="python string">'activity_id'</code><code class="python plain">: activity_id,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'activity'</code><code class="python plain">: activity, </code><code class="python string">'edit'</code><code class="python plain">: </code><code class="python color1">True</code><code class="python plain">}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/new.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python plain">review(request, activity_id):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">get_object_or_404(Activity, pk</code><code class="python keyword">=</code><code class="python plain">activity_id)</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># We have two types of reviews: the one that is submitted by the</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># presidency (first), and the one that is done by the deanship.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.add_presidency_review'</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type </code><code class="python keyword">=</code> <code class="python string">'P'</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">elif</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.add_deanship_review'</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type </code><code class="python keyword">=</code> <code class="python string">'D'</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">raise</code> <code class="python plain">PermissionDenied</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.method </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'POST'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">: </code><code class="python comments"># If the review is already there, edit it.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_object </code><code class="python keyword">=</code> <code class="python plain">Review.objects.get(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type</code><code class="python keyword">=</code><code class="python plain">review_type)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">ObjectDoesNotExist:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_object </code><code class="python keyword">=</code> <code class="python plain">Review(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">reviewer</code><code class="python keyword">=</code><code class="python plain">request.user,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type</code><code class="python keyword">=</code><code class="python plain">review_type)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review </code><code class="python keyword">=</code> <code class="python plain">ReviewForm(request.POST, instance</code><code class="python keyword">=</code><code class="python plain">review_object)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">review.is_valid():</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review.save()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">review.cleaned_data[</code><code class="python string">'is_approved'</code><code class="python plain">]:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity.is_editable </code><code class="python keyword">=</code> <code class="python color1">False</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity.save()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">HttpResponseRedirect(reverse(</code><code class="python string">'activities:show'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">args</code><code class="python keyword">=</code><code class="python plain">(activity_id,)))</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">: </code><code class="python comments"># If the review is already there, edit it.</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_object </code><code class="python keyword">=</code> <code class="python plain">Review.objects.get(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type</code><code class="python keyword">=</code><code class="python plain">review_type)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review </code><code class="python keyword">=</code> <code class="python plain">ReviewForm(instance</code><code class="python keyword">=</code><code class="python plain">review_object)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">except</code> <code class="python plain">ObjectDoesNotExist:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review </code><code class="python keyword">=</code> <code class="python plain">ReviewForm()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'activity'</code><code class="python plain">: activity,</code><code class="python string">'review'</code><code class="python plain">: review, </code><code class="python string">'review_type'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">review_type}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/review.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python plain">participate(request, activity_id):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">get_object_or_404(Activity, pk</code><code class="python keyword">=</code><code class="python plain">activity_id)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">colleges </code><code class="python keyword">=</code> <code class="python plain">activity.participant_colleges.</code><code class="python functions">all</code><code class="python plain">()</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">colleges:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">request.user</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">existing_participation </code><code class="python keyword">=</code> <code class="python plain">Participation.objects.</code><code class="python functions">filter</code><code class="python plain">(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user</code><code class="python keyword">=</code><code class="python plain">request.user)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'activity'</code><code class="python plain">: activity}</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">existing_participation:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'error_message'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python string">'already_applied'</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/participate.html'</code><code class="python plain">, context)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.method </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'POST'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">request.POST[</code><code class="python string">'status'</code><code class="python plain">] </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">'1'</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">Participation.objects.create(activity</code><code class="python keyword">=</code><code class="python plain">activity,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">user</code><code class="python keyword">=</code><code class="python plain">request.user)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">HttpResponseRedirect(reverse(</code><code class="python string">'activities:participate_done'</code><code class="python plain">,</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">args</code><code class="python keyword">=</code><code class="python plain">(activity_id,)))</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context[</code><code class="python string">'error_message'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python string">'unknown'</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/participate.html'</code><code class="python plain">, context)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/participate.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python plain">view_participation(request, activity_id):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">get_object_or_404(Activity, pk</code><code class="python keyword">=</code><code class="python plain">activity_id)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python keyword">not</code> <code class="python plain">activity.primary_club </code><code class="python keyword">in</code> <code class="python plain">request.user.coordination.</code><code class="python functions">all</code><code class="python plain">() </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.view_participation'</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">raise</code> <code class="python plain">PermissionDenied</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">participations </code><code class="python keyword">=</code> <code class="python plain">Participation.objects.</code><code class="python functions">filter</code><code class="python plain">(activity</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">context </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'participations'</code><code class="python plain">: participations, </code><code class="python string">'activity'</code><code class="python plain">: activity}</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">render(request, </code><code class="python string">'activities/view_participations.html'</code><code class="python plain">, context)</code><br/>
&nbsp;<br/>
<code class="python decorator">@login_required</code><br/>
<code class="python keyword">def</code> <code class="python plain">download_participation(request, activity_id):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">activity </code><code class="python keyword">=</code> <code class="python plain">get_object_or_404(Activity, pk</code><code class="python keyword">=</code><code class="python plain">activity_id)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python keyword">not</code> <code class="python plain">activity.primary_club </code><code class="python keyword">in</code> <code class="python plain">request.user.coordination.</code><code class="python functions">all</code><code class="python plain">() </code><code class="python keyword">and</code> <code class="python plain">\</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">not</code> <code class="python plain">request.user.has_perm(</code><code class="python string">'activities.view_participation'</code><code class="python plain">):</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">raise</code> <code class="python plain">PermissionDenied</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">participations </code><code class="python keyword">=</code> <code class="python plain">Participation.objects.</code><code class="python functions">filter</code><code class="python plain">(activity</code><code class="python keyword">=</code><code class="python plain">activity)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">response </code><code class="python keyword">=</code> <code class="python plain">HttpResponse(content_type</code><code class="python keyword">=</code><code class="python string">'text/csv'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">response[</code><code class="python string">'Content-Disposition'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python string">'attachment; filename="Participants in Activity %s.csv"'</code> <code class="python keyword">%</code> <code class="python plain">activity_id</code><br/>
&nbsp;<br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">writer </code><code class="python keyword">=</code> <code class="python plain">unicodecsv.writer(response, encoding</code><code class="python keyword">=</code><code class="python string">'utf-8'</code><code class="python plain">)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">writer.writerow([u</code><code class="python string">"الاسم"</code><code class="python plain">, u</code><code class="python string">"البريد"</code><code class="python plain">])</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">for</code> <code class="python plain">participantion </code><code class="python keyword">in</code> <code class="python plain">participations:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">participantion.user.first_name:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">name </code><code class="python keyword">=</code> <code class="python plain">u</code><code class="python string">"%s %s"</code> <code class="python keyword">%</code> <code class="python plain">(participantion.user.first_name, participantion.user.last_name)</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">name </code><code class="python keyword">=</code> <code class="python plain">participantion.user.username</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">email </code><code class="python keyword">=</code> <code class="python plain">participantion.user.email</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">writer.writerow([name, email])</code><br/>
<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">response</code>
</p>
      </bdi></div>
        
        <div id='portal_title' class="step" data-x="-6000" data-y="-2000" data-z="500" data-rotate-x="90" data-scale="2"><bdi>
        <img src="img/enjaz_logo_shadow.png" width="100%"/>
      </bdi></div>
        
      <div id='final' class="step" data-x="-6000" data-y="400" data-scale="0.4"><bdi>
        <p>والآن!</p>
      </bdi></div>
        
        <div id='contact' class="step" data-x="-6000" data-y="400" data-rotate-y="90"><bdi>
        <p>www.enjazportal.com</p>
        <p>hello@enjazportal.com</p>
      </bdi></div>
    </div>
    <script type="text/javascript" src="js/impress_ar.js"></script>
    <script type="text/javascript">impress().init();</script>
    <script type="text/javascript">
     SyntaxHighlighter.all()
    </script>
  </body>
</html>
